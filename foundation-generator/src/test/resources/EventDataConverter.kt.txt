package test.event.generated

import net.ntworld.foundation.Message
import net.ntworld.foundation.MessageConverter
import net.ntworld.foundation.eventSourcing.EventDataMessageConverterUtility

object CreatedEventDataMessageConverter : MessageConverter<CreatedEventData> {
  override fun fromMessage(message: Message) = CreatedEventData(
    id = message.attributes["id"] as String,
    streamId = message.attributes["streamId"] as String,
    streamType = message.attributes["streamType"] as String,
    version = message.attributes["version"] as Int,
    data = message.attributes["data"] as Map<String, Any>,
    metadata = message.attributes["metadata"] as Map<String, Any>
  )
  override fun toMessage(input: CreatedEventData): Message = EventMessageConverter.toMessage(input)

  override fun canConvert(message: Message) = message.type == EventMessageConverter.MESSAGE_TYPE &&
      message.attributes["type"] == "created" && message.attributes["variant"] == 0
}